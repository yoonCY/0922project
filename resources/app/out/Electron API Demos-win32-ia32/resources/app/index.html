<!DOCTYPE html>
<html>
<head>
    <title> 아이웨딩 B </title>

</head>


<body>


<!--
<webview id="webview2" preload="./onload.js"  src="http://kin123s:tlqkf1@with.iwedding.co.kr" minwidth="576" minheight="432" style=" width: 10%; height: 99%;" ></webview>

<webview id="webview" preload="./onload.js"  src="http://kin123s:tlqkf1@with.iwedding.co.kr/with2/icard_registration/chat/chat_with_cs/iwd407113/kin123s%40naver.com?title=%EC%9C%A4%EC%B0%AC%EC%98%81&application=1" minwidth="576" minheight="432" style=" position: absolute; width: 90%; height: 99%;" ></webview>
<webview id="webview" preload="./onload.js"  src="http://withmini.iwedding.co.kr/with_mini/select_type/index/select_type.php" minwidth="576" minheight="432" style=" position: absolute; width: 99%; height: 99%;" ></webview>

<webview id="webview" preload="./onload.js"  src="http://kin123s:tlqkf1@with.iwedding.co.kr/with2/icard_registration/chat/chat_with_cs/iwd407113/kin123s%40naver.com?title=%EC%9C%A4%EC%B0%AC%EC%98%81&application=1" minwidth="576" minheight="432" style=" position: absolute; width: 90%; height: 99%;" ></webview>
-->
<div class="indicator"></div>

<div class="webview_div">


    <webview id="webview" preload="./onload.js" webpreferences="nativeWindowOpen=yes"
             src="http://withmini.iwedding.co.kr/with_mini/select_type/index/select_type.php"
             minwidth="576" minheight="432"
             style=" position: absolute; width: 99%; height: 99%;"
    ></webview>

</div>

<script src="http://kin123s.iwedding.biz:4112/socket.io/socket.io.js "></script>
<script src="./config_script.js"></script>
<script>

    const socket = io.connect("http://kin123s.iwedding.biz:4112/iweddingb");

    var send_param = {
        user_id : "kin123s",
        user_type : 2,
        ent_code : 'test1',
    };

    socket.emit("send:desktop_info",  send_param );

    socket.on("get:notifications", function(data){
        console.log("노티피!", data);
        notifications_fnc(data);
    });

    const electron = require('electron');
    const notifier = require('electron-notifications');
    const webview = document.getElementById('webview');
    const {ipcRenderer} = require('electron');
    //var eNotify = require('electron-native-notification');

    console.log( notifier );

    onload = function(){

        const indicator = document.querySelector('.indicator');


        const loadstart = function () {
           // 로딩중
            indicator.innerHTML = '<img src="http://www.ifamily.co.kr/image/iFamily/main/index/visual_artist07.png" > ';
            //console.log(document.getElementById('webview_div').style.display );
            webview.style= 'width: 0px; height: 0px; flex: 0 1;';
            //document.getElementById('webview_div').style.display == "block";
        };

        const loadstop = function () {
            // 로딩끝
            indicator.innerHTML = '';
            console.log("디스플레이!");
            webview.style= 'position: absolute; width: 99%; height: 99%;';
            //webview.style.display == 'block';

        };
        notifications_fnc( new Array() );

        webview.addEventListener('did-start-loading', loadstart);
        webview.inspectServiceWorker();


        webview.addEventListener('did-stop-loading', loadstop);

        var imessage_notifier = notifier.notify(  "메시지 알림" ,{
            message: '메시지가 도착했습니다.',
            body : "asdf4112",
            //icon: 'http://cl.ly/J49B/3951818241085781941.png',
            buttons: ['보기', '닫기'],
            //duration : 10000,
            flat : true,
            //vertical : true
        });



        //const webview = document.querySelector('webview');
        var i = 0;

        webview.addEventListener('ipc-message', function( e ) {
            if( e.channel == "send:notifications" ){
                notifications_fnc(e);
            }

            else if( e.channel == "send:authuser" ){
                insert_user_data(e);
            }

        });

        //const webview = document.getElementById('foo')
        webview.addEventListener("dom-ready", function(){
            webview.openDevTools();

        });

        webview.addEventListener('new-window', function(evt, url, frameName, disposition, options, additionalFeatures) {
            evt.preventDefault();

            ipcRenderer.send("new_window", evt);
            //var win = new BrowserWindow( require('./config/default').window ); // evt.options
            console.log("e", evt);
            console.log("e", evt.url);
            console.log("e", evt.options);
            console.log("e", evt);

            //win.loadURL( evt.url );

        });

        //setInterval( function(){




        var runKakao = function() {
            setTimeout(function() {
                //webview.loadURL("http://kin123s:tlqkf1@with.iwedding.co.kr/with2/icard_registration/chat/chat_with_cs/iwd407113/kin123s%40naver.com?title=%EC%9C%A4%EC%B0%AC%EC%98%81", {
                //    userAgent: "Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36"
                //});
                setTimeout(function() {
                    /*
                    if (webview.getURL() !== "https://login.ticketmonster.co.kr/user/buyInfo") {

                        webview.executeJavaScript('$("#userid").val("XXXXXXXXX");');
                        webview.executeJavaScript('$("#pwd").val("XXXXX");');
                        webview.executeJavaScript('fn_submit2();');

                        console.log("LOGIN");
                    } else {
                        console.log("LOGIN");
                    }
                    */
                    //webview.executeJavaScript( "alert(authkey);" );
                    //webview.executeJavaScript( "console.log(authkey);" );

                    //webview.send('ping');
                }, 1000 * 5);

            }, 1000 * 3);

        };
        //runKakao();
    };
</script>
</body>

</html>

